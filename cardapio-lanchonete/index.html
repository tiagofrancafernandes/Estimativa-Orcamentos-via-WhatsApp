<!DOCTYPE html>
<html lang="pt-br" x-data="lanchoneteApp()" x-cloak>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cardápio Lanchonete</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <style>
    [x-cloak] { display: none !important; }
  </style>
</head>
<body class="bg-gray-50 min-h-screen flex flex-col">

  <header class="bg-green-600 text-white p-4 flex justify-center">
    <h1 class="text-3xl font-bold">Cardápio Lanchonete</h1>
  </header>

  <main class="flex-grow container mx-auto p-4 space-y-6">

    <!-- Cardápio -->
    <section>
      <h2 class="text-2xl font-semibold mb-4">Cardápio</h2>
      <template x-for="(items, category) in cardapio" :key="category">
        <div class="mb-8">
          <h3 class="text-xl font-bold mb-3 capitalize" x-text="category"></h3>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <template x-for="item in items" :key="item.id">
              <button
                @click="openModal(item)"
                class="bg-white rounded shadow p-4 text-left hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-green-500 transition"
              >
                <h4 class="font-semibold text-lg" x-text="item.name"></h4>
                <p class="mt-1 text-sm text-gray-600" x-show="item.ingredients" x-text="item.ingredients.join(', ')"></p>
                <div class="mt-2 font-bold text-green-700">R$ <span x-text="item.price.toFixed(2)"></span></div>
              </button>
            </template>
          </div>
        </div>
      </template>
    </section>

    <!-- Carrinho -->
    <section class="bg-white rounded-lg shadow p-4">
      <h2 class="text-2xl font-semibold mb-4">Carrinho</h2>
      <template x-if="cart.length === 0">
        <p class="text-gray-600">Seu carrinho está vazio.</p>
      </template>
      <template x-for="(item, index) in cart" :key="index">
        <div class="border-b py-3 flex flex-col md:flex-row md:items-center md:justify-between gap-2">
          <div class="flex-1">
            <h3 class="font-semibold" x-text="item.name"></h3>
            <template x-if="item.ingredients && item.ingredients.length">
              <p class="text-sm text-gray-500" x-text="item.ingredients.join(', ')"></p>
            </template>
            <template x-if="item.observation">
              <p class="text-sm text-gray-700 italic">Obs: <span x-text="item.observation"></span></p>
            </template>
          </div>
          <div class="flex items-center space-x-2 mt-2 md:mt-0">
            <label class="text-sm">Qtd:</label>
            <input 
              type="number" min="1" class="w-16 border rounded px-2 py-1 text-center" 
              x-model.number="item.quantity" 
              @input="if(item.quantity < 1) item.quantity=1; updateTotal()"
            >
            <label class="text-sm">Obs:</label>
            <input 
              type="text" placeholder="Ex: sem cebola" 
              class="border px-2 py-1 rounded w-40"
              x-model="item.observation"
            >
            <button 
              class="text-red-600 hover:text-red-800 font-bold px-2 py-1"
              @click="removeFromCart(index)"
              title="Remover"
            >×</button>
            <div class="font-bold text-green-700 ml-4">R$ <span x-text="(item.price * item.quantity).toFixed(2)"></span></div>
          </div>
        </div>
      </template>

      <div class="mt-4 flex justify-between font-bold text-lg">
        <span>Total:</span>
        <span>R$ <span x-text="total.toFixed(2)"></span></span>
      </div>
      <div class="mt-4 flex justify-end">
        <button 
          class="bg-green-600 text-white px-4 py-2 rounded disabled:opacity-50"
          :disabled="cart.length === 0"
          @click="showPayment = true"
        >Fechar Pedido</button>
      </div>
    </section>

    <!-- Modal Produto -->
    <div 
      x-show="showModal" 
      x-transition
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
      @click.away="closeModal()"
    >
      <div 
        class="bg-white rounded-lg shadow-lg max-w-lg w-full p-6 relative" 
        @keydown.escape.window="closeModal()"
        @click.stop
      >
        <button 
          class="absolute top-2 right-3 text-gray-600 hover:text-gray-900 text-2xl font-bold"
          @click="closeModal()"
          aria-label="Fechar"
        >&times;</button>

        <h2 class="text-2xl font-bold mb-2" x-text="currentItem.name"></h2>
        <template x-if="currentItem.ingredients && currentItem.ingredients.length">
          <p class="text-gray-700 mb-3"><strong>Ingredientes:</strong> <span x-text="currentItem.ingredients.join(', ')"></span></p>
        </template>

        <p class="text-green-700 font-bold mb-4">R$ <span x-text="currentItem.price.toFixed(2)"></span></p>

        <div class="space-y-3">
          <div>
            <label class="block font-semibold mb-1">Quantidade</label>
            <input type="number" min="1" class="w-24 border rounded px-2 py-1" x-model.number="modalQuantity">
          </div>
          <div>
            <label class="block font-semibold mb-1">Observação</label>
            <textarea rows="2" class="w-full border rounded px-2 py-1" x-model="modalObservation" placeholder="Ex: sem cebola, bem assado..."></textarea>
          </div>
        </div>

        <div class="mt-6 flex justify-end space-x-3">
          <button 
            class="bg-gray-300 text-gray-700 rounded px-4 py-2 hover:bg-gray-400"
            @click="closeModal()"
          >Cancelar</button>
          <button 
            class="bg-green-600 text-white rounded px-4 py-2 hover:bg-green-700"
            @click="addToCart()"
          >Adicionar ao carrinho</button>
        </div>
      </div>
    </div>

    <!-- Modal Fechar Pedido -->
    <div 
      x-show="showPayment" 
      x-transition
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 overflow-auto p-4"
      @click.away="showPayment = false"
    >
      <div 
        class="bg-white rounded-lg shadow-lg max-w-3xl w-full p-6 relative" 
        @keydown.escape.window="showPayment = false"
        @click.stop
      >
        <button 
          class="absolute top-2 right-3 text-gray-600 hover:text-gray-900 text-2xl font-bold"
          @click="showPayment = false"
          aria-label="Fechar"
        >&times;</button>

        <h2 class="text-2xl font-bold mb-4">Fechar Pedido</h2>

        <!-- Pagamento -->
        <section class="mb-6">
          <h3 class="font-semibold mb-2">Método(s) de pagamento</h3>
          <template x-for="method in paymentMethods" :key="method">
            <label class="inline-flex items-center mr-6 mb-2 cursor-pointer">
              <input type="checkbox" :value="method" x-model="paymentSelection" class="form-checkbox text-green-600" />
              <span class="ml-2 capitalize" x-text="method"></span>
            </label>
          </template>
          <textarea 
            rows="2" 
            placeholder="Observação pagamento: Ex: troco para 100 reais" 
            class="w-full border rounded px-2 py-1 mt-2 resize-none"
            x-model="paymentObservation"
          ></textarea>
        </section>

        <!-- Endereço -->
        <section class="mb-6">
          <h3 class="font-semibold mb-2">Endereço e Contato</h3>
          <div class="mb-3">
            <label class="block mb-1 font-semibold">Endereço completo</label>
            <input type="text" x-model="address" placeholder="Rua, número, bairro" class="w-full border rounded px-3 py-2"/>
          </div>
          <div class="mb-3">
            <label class="block mb-1 font-semibold">Referência</label>
            <input type="text" x-model="reference" placeholder="Ex: perto do mercado" class="w-full border rounded px-3 py-2"/>
          </div>
          <div class="mb-3">
            <label class="block mb-1 font-semibold">Telefone para contato</label>
            <input type="tel" x-model="phone" placeholder="(99) 99999-9999" class="w-full border rounded px-3 py-2"/>
          </div>
          <div>
            <label class="block mb-1 font-semibold">Observação Entrega</label>
            <textarea 
              rows="2" 
              placeholder="Ex: avisar ao sair para entrega, ligar quando chegar..." 
              class="w-full border rounded px-2 py-1 resize-none"
              x-model="deliveryObservation"
            ></textarea>
          </div>
        </section>

        <div class="flex justify-end space-x-3">
          <button 
            class="bg-gray-300 text-gray-700 rounded px-4 py-2 hover:bg-gray-400"
            @click="showPayment = false"
          >Voltar</button>
          <button 
            class="bg-green-600 text-white rounded px-4 py-2 hover:bg-green-700"
            :disabled="!canSubmitOrder"
            @click="showSummary = true; showPayment = false"
          >Visualizar resumo do pedido</button>
        </div>
      </div>
    </div>

    <!-- Modal Resumo Pedido -->
    <div
      x-show="showSummary"
      x-transition
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 overflow-auto p-4"
      @click.away="showSummary = false"
    >
      <div 
        class="bg-white rounded-lg shadow-lg max-w-3xl w-full p-6 relative" 
        @keydown.escape.window="showSummary = false"
        @click.stop
      >
        <button 
          class="absolute top-2 right-3 text-gray-600 hover:text-gray-900 text-2xl font-bold"
          @click="showSummary = false"
          aria-label="Fechar"
        >&times;</button>

        <h2 class="text-2xl font-bold mb-4">Resumo do Pedido</h2>

        <!-- Itens -->
        <section class="mb-6 max-h-64 overflow-y-auto border rounded p-3 bg-gray-50">
          <template x-for="(item, index) in cart" :key="index">
            <div class="mb-3 border-b pb-2 last:border-none last:pb-0">
              <h3 class="font-semibold" x-text="item.name"></h3>
              <p class="text-sm text-gray-600" x-show="item.ingredients?.length > 0" x-text="'Ingredientes: ' + item.ingredients.join(', ')"></p>
              <p class="text-sm italic" x-show="item.observation" x-text="'Obs: ' + item.observation"></p>
              <p class="font-semibold mt-1">Qtd: <span x-text="item.quantity"></span> | R$ <span x-text="(item.price * item.quantity).toFixed(2)"></span></p>
            </div>
          </template>
          <div class="font-bold text-lg text-green-700 text-right">Total: R$ <span x-text="total.toFixed(2)"></span></div>
        </section>

        <!-- Dados pagamento e entrega -->
        <section class="mb-6 space-y-2">
          <h3 class="font-semibold">Pagamento</h3>
          <p x-show="paymentSelection.length === 0" class="text-red-600 italic">Nenhum método selecionado</p>
          <ul class="list-disc list-inside" x-show="paymentSelection.length > 0">
            <template x-for="p in paymentSelection" :key="p">
              <li x-text="p" class="capitalize"></li>
            </template>
          </ul>
          <p x-show="paymentObservation" class="italic">Obs: <span x-text="paymentObservation"></span></p>
        </section>

        <section class="mb-6 space-y-2">
          <h3 class="font-semibold">Endereço e Contato</h3>
          <p><strong>Endereço:</strong> <span x-text="address || '[não informado]'"></span></p>
          <p><strong>Referência:</strong> <span x-text="reference || '[não informado]'"></span></p>
          <p><strong>Telefone:</strong> <span x-text="phone || '[não informado]'"></span></p>
          <p x-show="deliveryObservation"><strong>Obs. entrega:</strong> <span x-text="deliveryObservation"></span></p>
        </section>

        <div class="flex justify-between">
          <button 
            class="bg-yellow-500 text-white rounded px-4 py-2 hover:bg-yellow-600"
            @click="showSummary = false; showPayment = true"
          >Editar pedido e dados</button>
          <button 
            class="bg-green-700 text-white rounded px-4 py-2 hover:bg-green-800"
            :disabled="!canSubmitOrder"
            @click="confirmOrder()"
          >Confirmar pedido</button>
        </div>

      </div>
    </div>

  </main>

  <footer class="bg-green-600 text-white text-center p-4 mt-auto">
    &copy; 2025 Lanchonete Exemplo
  </footer>

<script>
function lanchoneteApp(){
  return {
    cardapio: {
      sucos: [
        {id:1, name:'Suco de Laranja', ingredients:['Laranja natural'], price:6.00},
        {id:2, name:'Suco de Abacaxi', ingredients:['Abacaxi natural'], price:6.00},
        {id:3, name:'Suco de Maracujá', ingredients:['Maracujá natural'], price:6.00},
      ],
      refrigerantes: [
        {id:4, name:'Coca-Cola 350ml', ingredients:null, price:5.00},
        {id:5, name:'Guaraná 350ml', ingredients:null, price:5.00},
        {id:6, name:'Fanta Laranja 350ml', ingredients:null, price:5.00},
      ],
      salgados: [
        {id:7, name:'Coxinha', ingredients:['Frango', 'Catupiry'], price:5.50},
        {id:8, name:'Pastel de Queijo', ingredients:['Queijo mussarela'], price:6.00},
        {id:9, name:'Empada de Frango', ingredients:['Frango', 'Creme'], price:4.50},
      ],
      pizzas: [
        {id:10, name:'Pizza Calabresa', ingredients:['Calabresa', 'Cebola', 'Queijo'], price:40.00},
        {id:11, name:'Pizza Mussarela', ingredients:['Queijo mussarela', 'Orégano'], price:39.00},
        {id:12, name:'Pizza Portuguesa', ingredients:['Presunto', 'Cebola', 'Ovo', 'Azeitona'], price:42.00},
      ],
      lanches: [
        {id:13, name:'X-Burguer', ingredients:['Pão', 'Hambúrguer', 'Queijo', 'Alface', 'Tomate'], price:25.00},
        {id:14, name:'X-Salada', ingredients:['Pão', 'Hambúrguer', 'Queijo', 'Alface', 'Tomate', 'Maionese'], price:27.00},
        {id:15, name:'Hot Dog', ingredients:['Pão', 'Salsicha', 'Molho'], price:15.00},
      ],
    },
    showModal: false,
    showPayment: false,
    showSummary: false,
    currentItem: null,
    modalQuantity: 1,
    modalObservation: '',
    cart: [],
    paymentMethods: ['dinheiro', 'cartão', 'pix', 'vale'],
    paymentSelection: [],
    paymentObservation: '',
    address: '',
    reference: '',
    phone: '',
    deliveryObservation: '',

    openModal(item){
      this.currentItem = {...item}; 
      this.modalQuantity = 1;
      this.modalObservation = '';
      this.showModal = true;
    },
    closeModal(){
      this.showModal = false;
    },
    addToCart(){
      // Verifica se já existe item igual com mesma observação para incrementar quantidade
      const idx = this.cart.findIndex(i => i.id === this.currentItem.id && i.observation?.trim().toLowerCase() === this.modalObservation.trim().toLowerCase());
      if(idx !== -1){
        this.cart[idx].quantity += this.modalQuantity;
      } else {
        const newItem = {
          id: this.currentItem.id,
          name: this.currentItem.name,
          ingredients: this.currentItem.ingredients ? [...this.currentItem.ingredients] : [],
          price: this.currentItem.price,
          quantity: this.modalQuantity,
          observation: this.modalObservation.trim()
        };
        this.cart.push(newItem);
      }
      this.updateTotal();
      this.closeModal();
    },
    removeFromCart(idx){
      this.cart.splice(idx,1);
      this.updateTotal();
    },

    updateTotal(){
      // Recalcula total (atualiza automaticamente)
      // total é propriedade computada com getter
    },

    get total(){
      return this.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
    },

    get canSubmitOrder(){
      return this.cart.length > 0 && this.paymentSelection.length > 0 && !!this.address.trim();
    },

    confirmOrder(){
      if(!this.canSubmitOrder){
        alert('Por favor, preencha os dados necessários antes de confirmar.');
        return;
      }

      // Montar mensagem para WhatsApp
      let msg = '*Pedido da Lanchonete*%0A%0A';

      msg += '*Itens:*%0A';
      this.cart.forEach(item => {
        let line = `- ${item.name} x${item.quantity}`;
        if(item.observation) line += ` (Obs: ${item.observation})`;
        line += `%0A`;
        msg += line;
      });
      msg += `%0A*Total*: R$ ${this.total.toFixed(2)}%0A%0A`;

      msg += '*Pagamento:*%0A';
      this.paymentSelection.forEach(method => {
        msg += `- ${method.charAt(0).toUpperCase() + method.slice(1)}%0A`;
      });
      if(this.paymentObservation.trim()){
        msg += `Obs: ${this.paymentObservation.trim()}%0A`;
      }
      msg += `%0A*Endereço:* ${this.address.trim()}%0A`;
      if(this.reference.trim()) msg += `Referência: ${this.reference.trim()}%0A`;
      if(this.phone.trim()) msg += `Telefone: ${this.phone.trim()}%0A`;
      if(this.deliveryObservation.trim()) msg += `Obs entrega: ${this.deliveryObservation.trim()}%0A`;

      // Número do WhatsApp - você deve substituir esse número com o número real da lanchonete:
      const whatsappNumber = "5591999999999"; // Exemplo +55 DDD Número

      const url = `https://wa.me/${whatsappNumber}?text=${msg}`;

      window.open(url, '_blank');

      // Resetar estado
      this.resetOrder();
      this.showSummary = false;
    },

    resetOrder(){
      this.cart = [];
      this.paymentSelection = [];
      this.paymentObservation = '';
      this.address = '';
      this.reference = '';
      this.phone = '';
      this.deliveryObservation = '';
    }
  }
}
</script>

</body>
</html>
